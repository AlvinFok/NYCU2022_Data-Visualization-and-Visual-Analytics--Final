<!DOCTYPE html>
<meta charset="utf-8" />

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v6.js"></script>

<!-- Load plotly.js into the DOM -->
<script src='https://cdn.plot.ly/plotly-2.16.1.min.js'></script>

<script src="https://code.jquery.com/jquery-3.6.3.min.js"
    integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>

<body>
    <label>Election Type:</label>
    <select id="electionType">
        <option>president</option>
        <option>legislator-at-large</option>
        <option>legislator</option>
    </select>
    <!-- Create a div where the graph will take place -->
    <!-- <label>Popularity Thresh<input id="popularity_input" type="text" value="80" onchange="mainPlot()"></input></label> -->
    <div id="barChart1"></div>
    <div id="barChart2"></div>
</body>

<script>
    //file list
    const files = {
        president: {
            "2016": {
                "by_city": "/dataset/voteData/cleaned/president/2016/by_city.csv",
                "by_nation": "/dataset/voteData/cleaned/president/2016/by_nation.csv",
                "candidate": "/dataset/voteData/cleaned/president/2016/candidate.csv",
            },
            "2020": {
                "by_city": "/dataset/voteData/cleaned/president/2020/by_city.csv",
                "by_nation": "/dataset/voteData/cleaned/president/2020/by_nation.csv",
                "candidate": "/dataset/voteData/cleaned/president/2020/candidate.csv",
            },
        },
        "legislator-at-large": {
            "2016": {
                "by_city": "/dataset/voteData/cleaned/legislator-at-large/2016/by_city.csv",
                "by_nation": "/dataset/voteData/cleaned/legislator-at-large/2016/by_nation.csv",
                "candidate": "/dataset/voteData/cleaned/legislator-at-large/2016/candidate.csv",
            },
            "2020": {
                "by_city": "/dataset/voteData/cleaned/legislator-at-large/2020/by_city.csv",
                "by_nation": "/dataset/voteData/cleaned/legislator-at-large/2020/by_nation.csv",
                "candidate": "/dataset/voteData/cleaned/legislator-at-large/2020/candidate.csv",
            },
        },
        legislator: {
            "2016": {
                "by_city": "/dataset/voteData/cleaned/legislator/2016/by_district.csv",
                "candidate": "/dataset/voteData/cleaned/legislator/2016/candidate.csv",
            },
            "2020": {
                "by_city": "/dataset/voteData/cleaned/legislator/2020/by_district.csv",
                "candidate": "/dataset/voteData/cleaned/legislator/2020/candidate.csv",
            },
        },
    };
    const years = ["2016", "2020"];
</script>

<script>
    function barChart(x, y, xLabel, yLabel, barText, divID) {
        var trace1 = {
            x: x,
            y: y,
            type: 'bar',
            text: barText,
            textposition: 'auto',
            hoverinfo: 'none',
            marker: {
                color: 'rgb(158,202,225)',
                opacity: 0.6,
                line: {
                    color: 'rgb(8,48,107)',
                    width: 1.5
                }
            }
        };

        var data = [trace1];

        var layout = {
            title: 'January 2013 Sales Report',
            barmode: 'stack',
            height: 800
        };

        Plotly.newPlot(divID, data, layout);

    }
</script>

<script>
    $("#electionType").on("change", function (e) {
        let selectedFiles = files[e.target.value];
        //redraw here ...
        if (e.target.value == "president") presidentPlot(selectedFiles);
        // other election type ...
    });

    function presidentPlot(files) {
        //years: 2016, 2020
        d3.csv(files["2016"].by_city).then((data) => {
            x = d3.map(data, d => d.candidate);
            y = d3.map(data, d => d.ticket);
            barText = d3.map(data, d => d.city);
            barChart(x, y, 'candidate', 'ticket', barText, 'barChart1');
        });
        d3.csv(files["2020"].by_city).then((data) => {
            x = d3.map(data, d => d.candidate);
            y = d3.map(data, d => d.ticket);
            barText = d3.map(data, d => d.city);
            barChart(x, y, 'candidate', 'ticket', barText, 'barChart2');
        });
    }

    presidentPlot(files["president"]);
</script>